<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1061px" preserveAspectRatio="none" style="width:1744px;height:1061px;" version="1.1" viewBox="0 0 1744 1061" width="1744px" zoomAndPan="magnify"><defs><filter height="300%" id="ff48owiro317e" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="338" x="704" y="26.708">Registration Flow (Upload + Register)</text><rect fill="#FFFFFF" filter="url(#ff48owiro317e)" height="615.4609" style="stroke: #000000; stroke-width: 2.0;" width="1627" x="106" y="342.1797"/><rect fill="#FFFFFF" filter="url(#ff48owiro317e)" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="522" x="1020" y="599.375"/><rect fill="#FFFFFF" filter="url(#ff48owiro317e)" height="232.7344" style="stroke: #000000; stroke-width: 2.0;" width="1426" x="116" y="717.9063"/><rect fill="#FFFFFF" height="56.9375" style="stroke: none; stroke-width: 1.0;" width="1426" x="116" y="893.7031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="27" x2="27" y1="121.25" y2="974.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="192" x2="192" y1="121.25" y2="974.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="492" x2="492" y1="121.25" y2="974.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="631" x2="631" y1="121.25" y2="974.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="780" x2="780" y1="121.25" y2="974.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="953" x2="953" y1="121.25" y2="974.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1094" x2="1094" y1="121.25" y2="974.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1218" x2="1218" y1="121.25" y2="974.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1344" x2="1344" y1="121.25" y2="974.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1476" x2="1476" y1="121.25" y2="974.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1632" x2="1632" y1="121.25" y2="974.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="117.9482">User</text><ellipse cx="27" cy="47.9531" fill="#FEFECE" filter="url(#ff48owiro317e)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,55.9531 L27,82.9531 M14,63.9531 L40,63.9531 M27,82.9531 L14,97.9531 M27,82.9531 L40,97.9531 " fill="none" filter="url(#ff48owiro317e)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="986.6357">User</text><ellipse cx="27" cy="999.9375" fill="#FEFECE" filter="url(#ff48owiro317e)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,1007.9375 L27,1034.9375 M14,1015.9375 L40,1015.9375 M27,1034.9375 L14,1049.9375 M27,1034.9375 L40,1049.9375 " fill="none" filter="url(#ff48owiro317e)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="126" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="133" y="105.9482">RegistrationTest</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="126" y="973.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="133" y="993.6357">RegistrationTest</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="406" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="413" y="105.9482">JwtAssertionGenerator</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="406" y="973.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="413" y="993.6357">JwtAssertionGenerator</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="83" x="588" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="595" y="105.9482">GetToken</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="83" x="588" y="973.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="595" y="993.6357">GetToken</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="685" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="692" y="105.9482">ObtainFileIdAndUploadUrl</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="685" y="973.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="692" y="993.6357">ObtainFileIdAndUploadUrl</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="886" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="893" y="105.9482">UploadFileToDas</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="886" y="973.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="893" y="993.6357">UploadFileToDas</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="1030" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1037" y="105.9482">CheckFileStatus</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="1030" y="973.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1037" y="993.6357">CheckFileStatus</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="1169" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1176" y="105.9482">RegisterFile</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="1169" y="973.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1176" y="993.6357">RegisterFile</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="1278" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1285" y="105.9482">WIPO OAuth2 AS</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="1278" y="973.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1285" y="993.6357">WIPO OAuth2 AS</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="1420" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="1427" y="105.9482">WIPO DAS API</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="1420" y="973.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="1427" y="993.6357">WIPO DAS API</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="177" x="1542" y="85.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="163" x="1549" y="105.9482">Pre-signed Upload Host</text><rect fill="#FEFECE" filter="url(#ff48owiro317e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="177" x="1542" y="973.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="163" x="1549" y="993.6357">Pre-signed Upload Host</text><polygon fill="#A80036" points="180,148.3828,190,152.3828,180,156.3828,184,152.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="186" y1="152.3828" y2="152.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="34" y="147.3169">Run with config + CSV</text><polygon fill="#A80036" points="480,177.5156,490,181.5156,480,185.5156,484,181.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="192" x2="486" y1="181.5156" y2="181.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="199" y="176.4497">generateAssertion()</text><polygon fill="#A80036" points="203,206.6484,193,210.6484,203,214.6484,199,210.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="197" x2="491" y1="210.6484" y2="210.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="209" y="205.5825">client_assertion (ES256)</text><polygon fill="#A80036" points="619.5,235.7813,629.5,239.7813,619.5,243.7813,623.5,239.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="192" x2="625.5" y1="239.7813" y2="239.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="199" y="234.7153">getAccessToken(assertion, issuer, scope)</text><polygon fill="#A80036" points="1332,264.9141,1342,268.9141,1332,272.9141,1336,268.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="631.5" x2="1338" y1="268.9141" y2="268.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="638.5" y="263.8481">POST /access_token (client_credentials)</text><polygon fill="#A80036" points="642.5,294.0469,632.5,298.0469,642.5,302.0469,638.5,298.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="636.5" x2="1343" y1="298.0469" y2="298.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="648.5" y="292.981">{access_token, expires_in}</text><polygon fill="#A80036" points="203,323.1797,193,327.1797,203,331.1797,199,327.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="197" x2="630.5" y1="327.1797" y2="327.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="209" y="322.1138">token</text><path d="M106,342.1797 L183,342.1797 L183,349.1797 L173,359.1797 L106,359.1797 L106,342.1797 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="615.4609" style="stroke: #000000; stroke-width: 2.0;" width="1627" x="106" y="342.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="121" y="355.2466">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="282" x="198" y="354.3901">[for each CSV row where registered != true]</text><polygon fill="#A80036" points="768.5,376.4453,778.5,380.4453,768.5,384.4453,772.5,380.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="192" x2="774.5" y1="380.4453" y2="380.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="199" y="375.3794">getFileIdAndUploadUrl()</text><polygon fill="#A80036" points="1464,405.5781,1474,409.5781,1464,413.5781,1468,409.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="780.5" x2="1470" y1="409.5781" y2="409.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="787.5" y="404.5122">POST /requests/files/url-uploads</text><polygon fill="#A80036" points="791.5,434.7109,781.5,438.7109,791.5,442.7109,787.5,438.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="785.5" x2="1475" y1="438.7109" y2="438.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="797.5" y="433.645">{fileId, fileUploadUrl}</text><polygon fill="#A80036" points="203,463.8438,193,467.8438,203,471.8438,199,467.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="197" x2="779.5" y1="467.8438" y2="467.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="209" y="462.7778">fileId, fileUploadUrl</text><polygon fill="#A80036" points="941,492.9766,951,496.9766,941,500.9766,945,496.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="192" x2="947" y1="496.9766" y2="496.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="199" y="491.9106">uploadMyFile()</text><polygon fill="#A80036" points="1620.5,522.1094,1630.5,526.1094,1620.5,530.1094,1624.5,526.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="953" x2="1626.5" y1="526.1094" y2="526.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="960" y="521.0435">PUT fileUploadUrl (PDF)</text><polygon fill="#A80036" points="964,551.2422,954,555.2422,964,559.2422,960,555.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="958" x2="1631.5" y1="555.2422" y2="555.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="970" y="550.1763">200</text><polygon fill="#A80036" points="1082.5,580.375,1092.5,584.375,1082.5,588.375,1086.5,584.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="192" x2="1088.5" y1="584.375" y2="584.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="199" y="579.3091">getFileStatus()</text><path d="M1020,599.375 L1097,599.375 L1097,606.375 L1087,616.375 L1020,616.375 L1020,599.375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="522" x="1020" y="599.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="1035" y="612.4419">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="1112" y="611.5854">[every 5s]</text><polygon fill="#A80036" points="1464,633.6406,1474,637.6406,1464,641.6406,1468,637.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1094.5" x2="1470" y1="637.6406" y2="637.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="1101.5" y="632.5747">GET /requests/files?fileId=...</text><polygon fill="#A80036" points="1105.5,662.7734,1095.5,666.7734,1105.5,670.7734,1101.5,666.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1099.5" x2="1475" y1="666.7734" y2="666.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="1111.5" y="661.7075">{fileStatusCategory | error}</text><polygon fill="#A80036" points="203,698.9063,193,702.9063,203,706.9063,199,702.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="197" x2="1093.5" y1="702.9063" y2="702.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="209" y="697.8403">ACCEPTED | REJECTED</text><path d="M116,717.9063 L180,717.9063 L180,724.9063 L170,734.9063 L116,734.9063 L116,717.9063 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="232.7344" style="stroke: #000000; stroke-width: 2.0;" width="1426" x="116" y="717.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="131" y="730.9731">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="195" y="730.1167">[ACCEPTED]</text><polygon fill="#A80036" points="1206.5,752.1719,1216.5,756.1719,1206.5,760.1719,1210.5,756.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="192" x2="1212.5" y1="756.1719" y2="756.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="199" y="751.106">registerFile()</text><polygon fill="#A80036" points="1464,781.3047,1474,785.3047,1464,789.3047,1468,785.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1218.5" x2="1470" y1="785.3047" y2="785.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="1225.5" y="780.2388">POST /requests/registrations</text><polygon fill="#A80036" points="1229.5,810.4375,1219.5,814.4375,1229.5,818.4375,1225.5,814.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1223.5" x2="1475" y1="814.4375" y2="814.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1235.5" y="809.3716">{requestAckId}</text><polygon fill="#A80036" points="203,839.5703,193,843.5703,203,847.5703,199,843.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="197" x2="1217.5" y1="843.5703" y2="843.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="209" y="838.5044">requestAckId</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="192" x2="234" y1="872.7031" y2="872.7031"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="234" x2="234" y1="872.7031" y2="885.7031"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="193" x2="234" y1="885.7031" y2="885.7031"/><polygon fill="#A80036" points="203,881.7031,193,885.7031,203,889.7031,199,885.7031" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="199" y="867.6372">Update CSV (file_id, registered=true, ack_id)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="116" x2="1542" y1="894.7031" y2="894.7031"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="121" y="904.9136">[REJECTED]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="192" x2="234" y1="929.6406" y2="929.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="234" x2="234" y1="929.6406" y2="942.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="193" x2="234" y1="942.6406" y2="942.6406"/><polygon fill="#A80036" points="203,938.6406,193,942.6406,203,946.6406,199,942.6406" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="199" y="924.5747">Log and continue</text><!--MD5=[0a605db58839d3d16a4f1e3f34d7051d]
@startuml
title Registration Flow (Upload + Register)

actor User
participant "RegistrationTest" as RT
participant "JwtAssertionGenerator" as JWT
participant "GetToken" as TOK
participant "ObtainFileIdAndUploadUrl" as OBF
participant "UploadFileToDas" as UPL
participant "CheckFileStatus" as CFS
participant "RegisterFile" as REG
participant "WIPO OAuth2 AS" as AS
participant "WIPO DAS API" as DAS
participant "Pre-signed Upload Host" as UPHOST

User -> RT: Run with config + CSV
RT -> JWT: generateAssertion()
JWT - -> RT: client_assertion (ES256)
RT -> TOK: getAccessToken(assertion, issuer, scope)
TOK -> AS: POST /access_token (client_credentials)
AS - -> TOK: {access_token, expires_in}
TOK - -> RT: token

loop for each CSV row where registered != true
  RT -> OBF: getFileIdAndUploadUrl()
  OBF -> DAS: POST /requests/files/url-uploads
  DAS - -> OBF: {fileId, fileUploadUrl}
  OBF - -> RT: fileId, fileUploadUrl

  RT -> UPL: uploadMyFile()
  UPL -> UPHOST: PUT fileUploadUrl (PDF)
  UPHOST - -> UPL: 200

  RT -> CFS: getFileStatus()
  loop every 5s
    CFS -> DAS: GET /requests/files?fileId=...
    DAS - -> CFS: {fileStatusCategory | error}
  end
  CFS - -> RT: ACCEPTED | REJECTED

  alt ACCEPTED
    RT -> REG: registerFile()
    REG -> DAS: POST /requests/registrations
    DAS - -> REG: {requestAckId}
    REG - -> RT: requestAckId
    RT -> RT: Update CSV (file_id, registered=true, ack_id)
  else REJECTED
    RT -> RT: Log and continue
  end
end

@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.8+9-Ubuntu-0ubuntu122.04.1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>